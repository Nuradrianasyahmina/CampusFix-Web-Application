<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Edit Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Segoe UI,sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(120deg,#eef2ff,#e0f2fe);
  display:flex;
  align-items:center;
  justify-content:center
}
body.dark{background:#020617;color:#e5e7eb}
a.back{position:absolute;top:30px;left:40px;color:#4f46e5;text-decoration:none}
.card{
  width:380px;background:#fff;border-radius:18px;padding:28px;
  box-shadow:0 25px 50px rgba(0,0,0,.1);text-align:center
}
body.dark .card{background:#020617}
.avatar{
  width:110px;height:110px;border-radius:50%;
  background:#e0e7ff;margin:0 auto 8px;
  position:relative;display:flex;align-items:center;justify-content:center;
  font-size:42px;font-weight:bold;color:#2563eb;cursor:pointer
}
.avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover}
.camera{
  position:absolute;bottom:6px;right:6px;
  background:#6366f1;color:#fff;border-radius:50%;
  width:28px;height:28px;display:flex;
  align-items:center;justify-content:center;font-size:14px
}
input{
  width:100%;padding:11px;margin-bottom:10px;
  border-radius:8px;border:1px solid #cbd5f5
}
input:disabled{background:#f1f5f9}
.small{font-size:12px;color:#64748b;text-align:left;margin-top:-6px;margin-bottom:10px}
button{
  width:100%;padding:12px;border:none;border-radius:10px;
  font-weight:600;cursor:pointer
}
.save{background:linear-gradient(90deg,#2563eb,#9333ea);color:#fff}
.settings{margin-top:10px;background:#f1f5f9}
body.dark .settings{background:#020617;color:#e5e7eb;border:1px solid #1e293b}

/* MODAL */
.modal-bg{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center
}
.modal{
  background:#fff;border-radius:16px;padding:22px;width:340px
}
body.dark .modal{background:#020617}
.modal h3{margin:0 0 6px}
.toggle{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px;border-radius:10px;margin:12px 0
}
.toggle.blue{background:#eff6ff}
.toggle.purple{background:#f5f3ff}
.modal button{width:auto;padding:10px 18px}
.actions{display:flex;justify-content:space-between;margin-top:10px}
</style>
</head>

<body>

<a class="back" href="#" id="backBtn">‚Üê Back to Dashboard</a>

<div class="card">
  <h2>Edit Profile</h2>
  <p style="color:#64748b">Update your personal information</p>

  <!-- PROFILE PICTURE -->
  <div class="avatar" id="avatarBtn">
    <span id="initial">A</span>
    <img id="avatarImg" hidden>
    <div class="camera">üì∑</div>
  </div>
  <input type="file" id="photoInput" hidden accept="image/*">

  <input id="email" disabled>
  <div class="small">Email cannot be changed</div>

  <input id="name" placeholder="Full Name *">
  <input id="phone" placeholder="Phone Number">

  <button class="save" id="saveBtn">Save Changes</button>
  <button class="settings" id="openSettings">‚öô Settings</button>
</div>

<!-- SETTINGS MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>‚öô Settings</h3>

    <div class="toggle blue">
      <span>Dark Mode</span>
      <input type="checkbox" id="dark">
    </div>

    <div class="actions">
      <button id="closeSettings">Cancel</button>
      <button class="save" id="saveSettings">Save</button>
    </div>
  </div>
</div>

<script>
/* =======================
   AUTH GUARD
======================= */
const token = localStorage.getItem("token");
if (!token) location.href = "login.html";

/* =======================
   LOAD PROFILE (LOCAL)
======================= */
const email = document.getElementById("email");
const nameInput = document.getElementById("name");
const phoneInput = document.getElementById("phone");
const avatarImg = document.getElementById("avatarImg");
const initial = document.getElementById("initial");
const photoInput = document.getElementById("photoInput");
const darkToggle = document.getElementById("dark");

email.value = localStorage.getItem("email") || "demo@student.edu.my";
nameInput.value = localStorage.getItem("name") || "";
phoneInput.value = localStorage.getItem("phone") || "";

const savedAvatar = localStorage.getItem("profileImage");
if (savedAvatar) {
  avatarImg.src = savedAvatar;
  avatarImg.hidden = false;
  initial.hidden = true;
} else {
  initial.textContent = (nameInput.value || "A").charAt(0).toUpperCase();
}

if (localStorage.getItem("darkMode") === "1") {
  document.body.classList.add("dark");
  darkToggle.checked = true;
}

/* =======================
   PROFILE IMAGE (BASE64)
======================= */
document.getElementById("avatarBtn").onclick = () => photoInput.click();

photoInput.onchange = () => {
  const file = photoInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    avatarImg.src = reader.result;
    avatarImg.hidden = false;
    initial.hidden = true;
    localStorage.setItem("profileImage", reader.result);
  };
  reader.readAsDataURL(file);
};

/* =======================
   SAVE PROFILE
======================= */
document.getElementById("saveBtn").onclick = () => {
  if (!nameInput.value.trim()) {
    alert("Name required");
    return;
  }

  localStorage.setItem("name", nameInput.value.trim());
  localStorage.setItem("phone", phoneInput.value);

  alert("Profile updated");
};

/* =======================
   SETTINGS MODAL
======================= */
openSettings.onclick = () => modalBg.style.display = "flex";
closeSettings.onclick = () => modalBg.style.display = "none";
saveSettings.onclick = () => {
  document.body.classList.toggle("dark", darkToggle.checked);
  localStorage.setItem("darkMode", darkToggle.checked ? "1" : "0");
  modalBg.style.display = "none";
};

/* =======================
   BACK
======================= */
backBtn.onclick = () => location.href = "user-dashboard.html";
</script>

</body>
</html>
